import{r as N,b as V,d as I,e as A,f as b,h as D,i as H,j as R,k as B,l as O}from"./@babel-a27dc793.js";import{p as U}from"./prop-types-387d7a00.js";import{r as F}from"./react-b6d3f6e6.js";import{r as x}from"./classnames-fc01e3fa.js";var E={},y={},T;function $(){if(T)return y;T=1,Object.defineProperty(y,"__esModule",{value:!0}),y.default=void 0;var m=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100,t,s;return function(){var o=+new Date,u=!!t&&o<t+r;u?(clearTimeout(s),s=setTimeout(function(){t=o,e()},r)):(t=o,e())}},i=m;return y.default=i,y}var l=O;Object.defineProperty(E,"__esModule",{value:!0});var j=E.default=void 0,M=l(N()),g=l(V()),W=l(I()),L=l(A()),z=l(b()),G=l(D()),J=l(H()),w=l(R()),K=l(B()),p=l(U),S=l(F),P=l(x()),Q=l($());function X(m,i){return m.length===i.length&&m.every(function(a,e){return a===i[e]})}var Y=function(m){(0,K.default)(i,m),(0,w.default)(i,null,[{key:"propTypes",get:function(){return{items:p.default.arrayOf(p.default.string).isRequired,currentClassName:p.default.string.isRequired,scrolledPastClassName:p.default.string,style:p.default.object,componentTag:p.default.oneOfType([p.default.string,p.default.elementType]),offset:p.default.number,rootEl:p.default.string,onUpdate:p.default.func}}},{key:"defaultProps",get:function(){return{items:[],currentClassName:"",style:{},componentTag:"ul",offset:0,onUpdate:function(){}}}}]);function i(a){var e;return(0,L.default)(this,i),e=(0,z.default)(this,(0,G.default)(i).call(this,a)),e.state={targetItems:[],inViewState:[],isScrolledPast:[]},e._handleSpy=e._handleSpy.bind((0,J.default)(e)),e}return(0,w.default)(i,[{key:"_initSpyTarget",value:function(e){var r=e.map(function(t){return document.getElementById(t)});return r}},{key:"_fillArray",value:function(e,r){for(var t=[],s=0,o=e.length;s<o;s++)t[s]=r;return t}},{key:"_isScrolled",value:function(){return this._getScrollDimension().scrollTop>0}},{key:"_getScrollDimension",value:function(){var e=document,r=this.props.rootEl,t=r?e.querySelector(r).scrollTop:e.documentElement.scrollTop||e.body.parentNode.scrollTop||e.body.scrollTop,s=r?e.querySelector(r).scrollHeight:e.documentElement.scrollHeight||e.body.parentNode.scrollHeight||e.body.scrollHeight;return{scrollTop:t,scrollHeight:s}}},{key:"_getElemsViewState",value:function(e){for(var r=[],t=[],s=[],o=e||this.state.targetItems,u=!1,f=0,h=o.length;f<h;f++){var n=o[f],d=u?!1:this._isInView(n);d?(u=!0,r.push(n)):t.push(n);var c=f===h-1,_=this._isScrolled(),v=this._isAtBottom()&&this._isInView(n)&&!d&&c&&_;v&&(t.pop(),t.push.apply(t,(0,W.default)(r)),r=[n],s=this._fillArray(s,!1),d=!0),s.push(d)}return{inView:r,outView:t,viewStatusList:s,scrolledPast:this.props.scrolledPastClassName&&this._getScrolledPast(s)}}},{key:"_isInView",value:function(e){if(!e)return!1;var r=this.props,t=r.rootEl,s=r.offset,o;t&&(o=document.querySelector(t).getBoundingClientRect());var u=e.getBoundingClientRect(),f=t?o.height:window.innerHeight,h=this._getScrollDimension(),n=h.scrollTop,d=n+f,c=t?u.top+n-o.top+s:u.top+n+s,_=c+e.offsetHeight;return c<d&&_>n}},{key:"_isAtBottom",value:function(){var e=this.props.rootEl,r=this._getScrollDimension(),t=r.scrollTop,s=r.scrollHeight,o=e?document.querySelector(e).getBoundingClientRect().height:window.innerHeight,u=t+o>=s;return u}},{key:"_getScrolledPast",value:function(e){if(!e.some(function(s){return s}))return e;var r=!1,t=e.map(function(s){return s&&!r?(r=!0,!1):!r});return t}},{key:"_spy",value:function(e){var r=this,t=this._getElemsViewState(e),s=this.state.inViewState;this.setState({inViewState:t.viewStatusList,isScrolledPast:t.scrolledPast},function(){r._update(s)})}},{key:"_update",value:function(e){X(this.state.inViewState,e)||this.props.onUpdate(this.state.targetItems[this.state.inViewState.indexOf(!0)])}},{key:"_handleSpy",value:function(){(0,Q.default)(this._spy(),100)}},{key:"_initFromProps",value:function(){var e=this._initSpyTarget(this.props.items);this.setState({targetItems:e}),this._spy(e)}},{key:"offEvent",value:function(){var e=this.props.rootEl?document.querySelector(this.props.rootEl):window;e.removeEventListener("scroll",this._handleSpy)}},{key:"onEvent",value:function(){var e=this.props.rootEl?document.querySelector(this.props.rootEl):window;e.addEventListener("scroll",this._handleSpy)}},{key:"componentDidMount",value:function(){this._initFromProps(),this.onEvent()}},{key:"componentWillUnmount",value:function(){this.offEvent()}},{key:"UNSAFE_componentWillReceiveProps",value:function(){this._initFromProps()}},{key:"render",value:function(){var e=this,r=this.props.componentTag,t=this.props,s=t.children,o=t.className,u=t.scrolledPastClassName,f=t.style,h=0,n=S.default.Children.map(s,function(c,_){var v;if(!c)return null;var C=c.type,k=u&&e.state.isScrolledPast[_],q=(0,P.default)((v={},(0,g.default)(v,"".concat(c.props.className),c.props.className),(0,g.default)(v,"".concat(e.props.currentClassName),e.state.inViewState[_]),(0,g.default)(v,"".concat(e.props.scrolledPastClassName),k),v));return S.default.createElement(C,(0,M.default)({},c.props,{className:q,key:h++}),c.props.children)}),d=(0,P.default)((0,g.default)({},"".concat(o),o));return S.default.createElement(r,{className:d,style:f},n)}}]),i}(S.default.Component);j=E.default=Y;export{j as _};
